# @import ./_common.http

{{
    exports.runId = Math.random().toString(36).slice(2, 8);
}}

###
# Scenario: Category sitemap data â€” before and after a new category

### 1) Get category sitemap data before (public)
# @title Get initial sitemap data
# @description Retrieves category sitemap data before creating new category
GET {{base}}/categories/sitemap-data
Accept: application/json
X-Api-Key: {{frontendKey}}

?? status == 200

### 2) Create a category (admin)
# @name createCategory
# @title Create sitemap demo category
# @description Creates a new category to demonstrate sitemap update
POST {{base}}/admin/categories
Accept: application/json
Content-Type: application/json
X-Api-Key: {{adminKey}}

{
  "name": "Sitemap Demo {{runId}}",
  "slug": "sitemap-demo-{{runId}}",
  "description": "Demonstrate sitemap",
  "parentCategoryId": null
}

?? status == 201

{{
  exports.categoryId = response.parsedBody.id;
  exports.categorySlug = response.parsedBody.slug;
  exports.categoryRowVersion = response.parsedBody.rowVersion;
}}

### 3) Get category sitemap data after (public)
# @ref createCategory
# @title Get updated sitemap data
# @description Retrieves category sitemap data after creating new category
GET {{base}}/categories/sitemap-data
Accept: application/json
X-Api-Key: {{frontendKey}}

?? status == 200

### Cleanup: Delete test category

### 4) Archive category (admin)
# @ref createCategory
# @name archiveCategory
# @title Archive category
# @description Archives the category before deletion
POST {{base}}/admin/categories/{{categoryId}}/archive
Accept: application/json
Content-Type: application/json
X-Api-Key: {{adminKey}}

{
  "rowVersion": {{categoryRowVersion}}
}

?? status == 200

{{
  exports.categoryRowVersion = response.parsedBody.rowVersion;
}}

### 5) Delete category (admin)
# @ref archiveCategory
# @title Delete category
# @description Deletes the archived category
DELETE {{base}}/admin/categories/{{categoryId}}?rowVersion={{categoryRowVersion}}
Accept: application/json
X-Api-Key: {{adminKey}}

?? status == 204
